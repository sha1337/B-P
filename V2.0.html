<!----------------- Try to keep all lines shorter or exactly 100 characters wide. ----------------->
<!-- 
CTRL+SHIFT+K:
CTRL+SHIFT+I:

dn.editor.setTheme("ace/theme/pastel_on_dark"); 
dn.editor.session.setFoldStyle("markbeginend");

-->
<html><head>
<style>

@import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700&subset=latin,greek,latin-ext);
body{
    	font-family		        : 'Ubuntu Mono';
		background-color	    :          #555;
		-webkit-touch-callout	:          none;
		-webkit-user-select  	:          none;
		 -khtml-user-select  	:          none;
		   -moz-user-select  	:          none;
		    -ms-user-select  	:          none;
		     -o-user-select	    :          none;
		        user-select		:          none;
		}
h3{
	color: green;
		}
h3 a{
	text-decoration: none;
	color: lime !important;
		}
h3 a:hover{
	text-decoration: none;
	color: yellow !important;
		}
#box{
    position:  absolute;
    
    top     :   000px !important ;
    right   :   000px !important ;
    width   :   100%  !important ;
    height  :   100%  !important ;

}            
</style>
<link rel="icon" href="fav.png" type="image/png" />
<title></title>
<script src="js/jquery-1.11.3.min.js"></script><!-- TODO: replace with document.querySelector()   https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector -->
<script src="js/three.min.js"        ></script>
<script src="js/misc.js"             ></script>
<script src="js/snipets.js"          ></script><!-- Included for testing of the snipets -->
<script type='text/JavaScript'>
var nGame = new Game();


window.onload=(function(){
    nGame.applySettings({
        // CSS selectors seems to be the nices way to pass DOM-Elements:
        "frame"				:	"#box",
    	"versionLocation"	:	"title, .versionText",
    	"debug"				:	true,
        "worldSize"         :   [2,3],
    });
	nGame.init();
    nGame.start();
	console.log(nGame);
});

/*




*/

function Game(){
	var VERSION = 2.0;
	
	// Settings:
	this.box;				// jQuery-Element of the canvas
	this.versionLocation;	//
	this.debug;				// boolean
	this.worldSize;			// two dimensional array
	
	var defaultSettings; // TODO: default settings
	this.applySettings = function(settingsObj){
		if(isDefined(settingsObj.frame)){ 
			this.box = $(settingsObj.frame);
		}
		if(isDefined(settingsObj.versionLocation))
			this.versionLocation = settingsObj.versionLocation;
		
		if(isDefined(settingsObj.debug))
			this.debug = settingsObj.debug;
		
		if(isDefined(settingsObj.worldSize)){
			this.worldSize = settingsObj.worldSize;
		}
		
	};//end Game.applySettings()
	
	this.running = false;
	this.start = function(){
		this.running = true;
		window.requestAnimationFrame(this.render); 
	};//end Game.start()
	
	this.stop = function(){
		this.running = false;
		window.cancelAnimationFrame(this.RAF_Id);
	};//end Game.stop() 
	
	// Generated in init()
	this.scene 		="";
	this.cam 		="";
	this.renderer	="";
	
	this.init = function(){
		var tmp;    
		$(this.versionLocation).text("B&P V"+VERSION);
		var ratio = this.box.width()/this.box.height();

		this.scene = new THREE.Scene();
		this.renderer = new THREE.WebGLRenderer({canvas: this.box[0], antialias:true});
		this.renderer.setSize(this.box.width(), this.box.height());
		
		this.cam = new THREE.PerspectiveCamera( 60, ratio, 0.1, 100 );
		this.cam.position.set(0,0,5);
		if(this.debug){
			this.scene.add(new THREE.AxisHelper(2));
		}// X red | y green | z blue
		
		//--//--//--//--//--//
		//  SCENE BUILDING  //
		//--//--//--//--//--//
		
		
		// terrain
		var terrainResolution = 2;
		
		//making terrain function:
		var ws = this.worldSize;
		function terrain(u,v){
			u = ws[0]*u;
			v = ws[1]*v;
	
			u -=ws[0]/2;
			v -=ws[1]/2;
	
	
			var h=0;    
			h = Math.random()*.05-0.02;
			h *= 3;
			var res = new THREE.Vector3(u,h,v);
			return res;
		};//end terrain()
		
		var terrainGeometry = new THREE.ParametricGeometry(
			terrain,
			terrainResolution*this.worldSize[0],
			terrainResolution*this.worldSize[1]);
			
		tmp = new THREE.MeshLambertMaterial({
			color: 0x888888
		});
		
		var terrainMesh = new THREE.Mesh( terrainGeometry, tmp );
		this.scene.add(terrainMesh);
		
		console.log(this.scene);
		
		function waterLevel(u,v){
			var h=0
			var scale = 10;
			//h = Math.cos(80*u+90*v)*u*.1;
			h = u *.02
			var res = new THREE.Vector3(.5-u,h,-.5+v);
			return res.multiplyScalar(scale);
		}
		
		var ocean= new THREE.ParametricGeometry(waterLevel,50,50);;
		
		var water = new THREE.MeshBasicMaterial({
			color: 0x0000ff
		});
		
		var oceanMesh = new THREE.Mesh(ocean,water);
		this.scene.add(oceanMesh);
		
		
		
		var pointLight = new THREE.PointLight( 0xffffff);
		pointLight.position.set(1,2,1);
		this.scene.add( pointLight );

		var sphereSize = 1;
		var pointLightHelper = new THREE.PointLightHelper( pointLight, sphereSize );
		this.scene.add( pointLightHelper );	
		
		var ambientLight = new THREE.AmbientLight( 0x555555 );
		this.scene.add(ambientLight)
		
		//this.scene.fog=new THREE.Fog("black", 3, 7);
		 
		return true;
	};//end Game.init()

	
	this.render = function(){
		var t = getTime();
		
		this.RAF_Id=requestAnimationFrame( this.render );
		var rot = new THREE.Euler(0,t,0,'XYZ');
		var pos = new THREE.Vector3(5,4,0);
		pos.applyEuler(rot).setLength(5);
		
		this.cam.position.set(pos.x, pos.y, pos.z);
		var zero = new THREE.Vector3(0,0,0);
		this.cam.lookAt(this.scene.position);
		this.renderer.render(this.scene, this.cam);
	}//end Game.render()
	.bind(this);
        
	
	
};// end Game()



</script>
</head><body>
	<h3>
		<a href="main.html" title="back">&#9664;</a>
		<span id="title"></span>
	</h3>
	<p></p>
	<hr>
	<canvas id="box"></canvas>
    
</body></html>